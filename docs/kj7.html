<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 KJ7 | Data 624 - KJ Assignments (HW2)</title>
  <meta name="description" content="Group 1’s HA Homework Assignments">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 KJ7 | Data 624 - KJ Assignments (HW2)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Group 1’s HA Homework Assignments" />
  <meta name="github-repo" content="baroncurtin2/data624" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 KJ7 | Data 624 - KJ Assignments (HW2)" />
  
  <meta name="twitter:description" content="Group 1’s HA Homework Assignments" />
  

<meta name="author" content="Group 1: Andrew Carson, Nathan Cooper, Baron Curtin, Heather Geiger">


<meta name="date" content="2019-04-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="kj6.html">
<link rel="next" href="kj8.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data 624-Group1-HW2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="kj6.html"><a href="kj6.html"><i class="fa fa-check"></i><b>2</b> KJ6</a><ul>
<li class="chapter" data-level="2.1" data-path="kj6.html"><a href="kj6.html#section"><i class="fa fa-check"></i><b>2.1</b> 6.3</a><ul>
<li class="chapter" data-level="2.1.1" data-path="kj6.html"><a href="kj6.html#a"><i class="fa fa-check"></i><b>2.1.1</b> a</a></li>
<li class="chapter" data-level="2.1.2" data-path="kj6.html"><a href="kj6.html#b"><i class="fa fa-check"></i><b>2.1.2</b> b</a></li>
<li class="chapter" data-level="2.1.3" data-path="kj6.html"><a href="kj6.html#c"><i class="fa fa-check"></i><b>2.1.3</b> c</a></li>
<li class="chapter" data-level="2.1.4" data-path="kj6.html"><a href="kj6.html#d"><i class="fa fa-check"></i><b>2.1.4</b> d</a></li>
<li class="chapter" data-level="2.1.5" data-path="kj6.html"><a href="kj6.html#e"><i class="fa fa-check"></i><b>2.1.5</b> e</a></li>
<li class="chapter" data-level="2.1.6" data-path="kj6.html"><a href="kj6.html#f"><i class="fa fa-check"></i><b>2.1.6</b> f</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="kj7.html"><a href="kj7.html"><i class="fa fa-check"></i><b>3</b> KJ7</a><ul>
<li class="chapter" data-level="3.1" data-path="kj7.html"><a href="kj7.html#section-1"><i class="fa fa-check"></i><b>3.1</b> 7.2</a><ul>
<li class="chapter" data-level="3.1.1" data-path="kj7.html"><a href="kj7.html#preliminary-steps"><i class="fa fa-check"></i><b>3.1.1</b> Preliminary steps</a></li>
<li class="chapter" data-level="3.1.2" data-path="kj7.html"><a href="kj7.html#neural-networks"><i class="fa fa-check"></i><b>3.1.2</b> Neural networks</a></li>
<li class="chapter" data-level="3.1.3" data-path="kj7.html"><a href="kj7.html#multivariate-adaptive-regression-splines-mars"><i class="fa fa-check"></i><b>3.1.3</b> Multivariate Adaptive Regression Splines (MARS)</a></li>
<li class="chapter" data-level="3.1.4" data-path="kj7.html"><a href="kj7.html#support-vector-machine-svm"><i class="fa fa-check"></i><b>3.1.4</b> Support Vector Machine (SVM)</a></li>
<li class="chapter" data-level="3.1.5" data-path="kj7.html"><a href="kj7.html#k-nearest-neighbors-knn"><i class="fa fa-check"></i><b>3.1.5</b> K-Nearest Neighbors (KNN)</a></li>
<li class="chapter" data-level="3.1.6" data-path="kj7.html"><a href="kj7.html#comparing-models"><i class="fa fa-check"></i><b>3.1.6</b> Comparing models</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="kj7.html"><a href="kj7.html#section-2"><i class="fa fa-check"></i><b>3.2</b> 7.5</a><ul>
<li class="chapter" data-level="3.2.1" data-path="kj7.html"><a href="kj7.html#initial-data-loading"><i class="fa fa-check"></i><b>3.2.1</b> Initial data loading</a></li>
<li class="chapter" data-level="3.2.2" data-path="kj7.html"><a href="kj7.html#impute-missing-values."><i class="fa fa-check"></i><b>3.2.2</b> Impute missing values.</a></li>
<li class="chapter" data-level="3.2.3" data-path="kj7.html"><a href="kj7.html#data-exploration-and-additional-manual-transformation"><i class="fa fa-check"></i><b>3.2.3</b> Data exploration and additional manual transformation</a></li>
<li class="chapter" data-level="3.2.4" data-path="kj7.html"><a href="kj7.html#automated-data-transformation-and-redo-exploration"><i class="fa fa-check"></i><b>3.2.4</b> Automated data transformation and redo exploration</a></li>
<li class="chapter" data-level="3.2.5" data-path="kj7.html"><a href="kj7.html#training-test-split"><i class="fa fa-check"></i><b>3.2.5</b> Training-test split</a></li>
<li class="chapter" data-level="3.2.6" data-path="kj7.html"><a href="kj7.html#building-models"><i class="fa fa-check"></i><b>3.2.6</b> Building models</a></li>
<li class="chapter" data-level="3.2.7" data-path="kj7.html"><a href="kj7.html#a-1"><i class="fa fa-check"></i><b>3.2.7</b> a</a></li>
<li class="chapter" data-level="3.2.8" data-path="kj7.html"><a href="kj7.html#b-1"><i class="fa fa-check"></i><b>3.2.8</b> b</a></li>
<li class="chapter" data-level="3.2.9" data-path="kj7.html"><a href="kj7.html#c-1"><i class="fa fa-check"></i><b>3.2.9</b> c</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="kj8.html"><a href="kj8.html"><i class="fa fa-check"></i><b>4</b> KJ8</a><ul>
<li class="chapter" data-level="4.1" data-path="kj8.html"><a href="kj8.html#section-3"><i class="fa fa-check"></i><b>4.1</b> 8.1</a><ul>
<li class="chapter" data-level="4.1.1" data-path="kj8.html"><a href="kj8.html#a-2"><i class="fa fa-check"></i><b>4.1.1</b> a</a></li>
<li class="chapter" data-level="4.1.2" data-path="kj8.html"><a href="kj8.html#b-2"><i class="fa fa-check"></i><b>4.1.2</b> b</a></li>
<li class="chapter" data-level="4.1.3" data-path="kj8.html"><a href="kj8.html#c-2"><i class="fa fa-check"></i><b>4.1.3</b> c</a></li>
<li class="chapter" data-level="4.1.4" data-path="kj8.html"><a href="kj8.html#d-1"><i class="fa fa-check"></i><b>4.1.4</b> d</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="kj8.html"><a href="kj8.html#section-4"><i class="fa fa-check"></i><b>4.2</b> 8.2</a></li>
<li class="chapter" data-level="4.3" data-path="kj8.html"><a href="kj8.html#section-5"><i class="fa fa-check"></i><b>4.3</b> 8.3</a><ul>
<li class="chapter" data-level="4.3.1" data-path="kj8.html"><a href="kj8.html#a-3"><i class="fa fa-check"></i><b>4.3.1</b> a</a></li>
<li class="chapter" data-level="4.3.2" data-path="kj8.html"><a href="kj8.html#b-3"><i class="fa fa-check"></i><b>4.3.2</b> b</a></li>
<li class="chapter" data-level="4.3.3" data-path="kj8.html"><a href="kj8.html#c-3"><i class="fa fa-check"></i><b>4.3.3</b> c</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="kj8.html"><a href="kj8.html#section-6"><i class="fa fa-check"></i><b>4.4</b> 8.7</a><ul>
<li class="chapter" data-level="4.4.1" data-path="kj8.html"><a href="kj8.html#a-4"><i class="fa fa-check"></i><b>4.4.1</b> a</a></li>
<li class="chapter" data-level="4.4.2" data-path="kj8.html"><a href="kj8.html#b-4"><i class="fa fa-check"></i><b>4.4.2</b> b</a></li>
<li class="chapter" data-level="4.4.3" data-path="kj8.html"><a href="kj8.html#c-4"><i class="fa fa-check"></i><b>4.4.3</b> c</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data 624 - KJ Assignments (HW2)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="kj7" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> KJ7</h1>
<div id="section-1" class="section level2">
<h2><span class="header-section-number">3.1</span> 7.2</h2>
<p><img src="kj7/7.2a.png" /></p>
<p><img src="kj7/7.2b.png" /></p>
<p><img src="kj7/7.2c.png" /></p>
<p>Set up training data.</p>
<pre class="sourceCode r"><code class="sourceCode r">trainingData &lt;-<span class="st"> </span><span class="kw">mlbench.friedman1</span>(<span class="dv">200</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</code></pre>
<p>Format training data.</p>
<pre class="sourceCode r"><code class="sourceCode r">trainingData<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(trainingData<span class="op">$</span>x)</code></pre>
<p>Plot training data predictors vs. outcome.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">featurePlot</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y)</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Looks like the first five predictors have a better correlation with the outcome than the last five.</p>
<p>Set up and format test data.</p>
<pre class="sourceCode r"><code class="sourceCode r">testData &lt;-<span class="st"> </span><span class="kw">mlbench.friedman1</span>(<span class="dv">5000</span>, <span class="dt">sd =</span> <span class="dv">1</span>)
testData<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(testData<span class="op">$</span>x)</code></pre>
<div id="preliminary-steps" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Preliminary steps</h3>
<p>Before we start creating models, let’s set our own seed, separate from the one used to create the input data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1392</span>)</code></pre>
<p>Also, write a function to look at error and R-squared of a given model applied to the test data.</p>
<pre class="sourceCode r"><code class="sourceCode r">error_and_Rsquared &lt;-<span class="st"> </span><span class="cf">function</span>(model){
    predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model,<span class="dt">newdata =</span> testData<span class="op">$</span>x)
    <span class="kw">return</span>(<span class="kw">postResample</span>(<span class="dt">pred =</span> predictions, <span class="dt">obs =</span> testData<span class="op">$</span>y))
}</code></pre>
</div>
<div id="neural-networks" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Neural networks</h3>
<p>Let’s try the neural networks method with model averaging.</p>
<pre class="sourceCode r"><code class="sourceCode r">nnetGrid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">.decay =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">.1</span>),
                <span class="dt">.size =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),
                <span class="dt">.bag =</span> <span class="ot">FALSE</span>)
averaging_nnet_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                            <span class="dt">method=</span><span class="st">&quot;avNNet&quot;</span>,
                            <span class="dt">tuneGrid =</span> nnetGrid,
                            <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                            <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                            <span class="dt">linout =</span> <span class="ot">TRUE</span>,
                            <span class="dt">trace=</span><span class="ot">FALSE</span>,
                            <span class="dt">maxit =</span> <span class="dv">500</span>)</code></pre>
</div>
<div id="multivariate-adaptive-regression-splines-mars" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Multivariate Adaptive Regression Splines (MARS)</h3>
<p>Use the earth command from the earth package.</p>
<pre class="sourceCode r"><code class="sourceCode r">MARS_model &lt;-<span class="st"> </span><span class="kw">earth</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y)</code></pre>
<p>Print model details.</p>
<pre class="sourceCode r"><code class="sourceCode r">MARS_model</code></pre>
<pre><code>## Selected 12 of 18 terms, and 6 of 10 predictors
## Termination condition: Reached nk 21
## Importance: X1, X4, X2, X5, X3, X6, X7-unused, X8-unused, X9-unused, ...
## Number of terms at each degree of interaction: 1 11 (additive model)
## GCV 2.540556    RSS 397.9654    GRSq 0.8968524    RSq 0.9183982</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(MARS_model)</code></pre>
<pre><code>## Call: earth(x=trainingData$x, y=trainingData$y)
## 
##                coefficients
## (Intercept)       18.451984
## h(0.621722-X1)   -11.074396
## h(0.601063-X2)   -10.744225
## h(X3-0.281766)    20.607853
## h(0.447442-X3)    17.880232
## h(X3-0.447442)   -23.282007
## h(X3-0.636458)    15.150350
## h(0.734892-X4)   -10.027487
## h(X4-0.734892)     9.092045
## h(0.850094-X5)    -4.723407
## h(X5-0.850094)    10.832932
## h(X6-0.361791)    -1.956821
## 
## Selected 12 of 18 terms, and 6 of 10 predictors
## Termination condition: Reached nk 21
## Importance: X1, X4, X2, X5, X3, X6, X7-unused, X8-unused, X9-unused, ...
## Number of terms at each degree of interaction: 1 11 (additive model)
## GCV 2.540556    RSS 397.9654    GRSq 0.8968524    RSq 0.9183982</code></pre>
<p>“Does MARS select the informative predictors (those named X1–X5)?”</p>
<p>For the most part, yes, but not entirely. The MARS model does include all five of the informative predictors (X1-X5) and excludes most of the last predictors that did not appear as correlated with outcome. However, it does also include one of the last predictors (X6).</p>
</div>
<div id="support-vector-machine-svm" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Support Vector Machine (SVM)</h3>
<p>I tried running SVM with a polynomial kernel here, but runtime was impractically long.</p>
<p>However, I will try running with both a linear and radial basis function kernel.</p>
<pre class="sourceCode r"><code class="sourceCode r">SVM_linear_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                        <span class="dt">method=</span><span class="st">&quot;svmLinear&quot;</span>,
                        <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                        <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                        <span class="dt">tuneLength =</span> <span class="dv">14</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">SVM_RBF_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                    <span class="dt">method=</span><span class="st">&quot;svmRadial&quot;</span>,
                    <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                    <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                    <span class="dt">tuneLength =</span> <span class="dv">14</span>)</code></pre>
</div>
<div id="k-nearest-neighbors-knn" class="section level3">
<h3><span class="header-section-number">3.1.5</span> K-Nearest Neighbors (KNN)</h3>
<p>Let’s run KNN just as it was run in the question example.</p>
<pre class="sourceCode r"><code class="sourceCode r">knn_model &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="dt">x =</span> trainingData<span class="op">$</span>x,
                <span class="dt">y =</span> trainingData<span class="op">$</span>y,
                <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
                <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                <span class="dt">tuneLength =</span> <span class="dv">10</span>)</code></pre>
</div>
<div id="comparing-models" class="section level3">
<h3><span class="header-section-number">3.1.6</span> Comparing models</h3>
<p>Run function to get error and R-squared for each model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(model <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;averaging_nnet_model&quot;</span>,<span class="st">&quot;MARS_model&quot;</span>,<span class="st">&quot;SVM_linear_model&quot;</span>,<span class="st">&quot;SVM_RBF_model&quot;</span>,<span class="st">&quot;knn_model&quot;</span>))
{
    <span class="kw">print</span>(model)
    <span class="kw">print</span>(<span class="kw">error_and_Rsquared</span>(<span class="kw">get</span>(model)))
}</code></pre>
<pre><code>## [1] &quot;averaging_nnet_model&quot;
##      RMSE  Rsquared       MAE 
## 2.1103508 0.8249747 1.5810554 
## [1] &quot;MARS_model&quot;
##      RMSE  Rsquared       MAE 
## 1.8136467 0.8677298 1.3911836 
## [1] &quot;SVM_linear_model&quot;
##      RMSE  Rsquared       MAE 
## 2.7633860 0.6973384 2.0970616 
## [1] &quot;SVM_RBF_model&quot;
##     RMSE Rsquared      MAE 
## 2.092662 0.822730 1.590366 
## [1] &quot;knn_model&quot;
##      RMSE  Rsquared       MAE 
## 3.2040595 0.6819919 2.5683461</code></pre>
<p>Looks like the best model here in terms of both R-squared (aka variance explained) and RMSE/MAE (minimizing error) within the test data is MARS.</p>
<p>After that, the neural network with model averaging and SVM with radial basis function both perform pretty similarly, falling slightly behind MARS but still doing pretty well.</p>
<p>The KNN and SVM with linear kernel models perform the worst out of the five models tested.</p>
</div>
</div>
<div id="section-2" class="section level2">
<h2><span class="header-section-number">3.2</span> 7.5</h2>
<p><img src="kj7/7.5.png" /></p>
<div id="initial-data-loading" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Initial data loading</h3>
<p>A chemical manufacturing process for a pharmaceutical product was discussed previously.</p>
<p>In this problem, the objective is to understand the relationship between biological measurements of the raw materials (predictors), measurements of the manufacturing process (predictors), and the response of product yield.</p>
<p>Biological predictors cannot be changed but can be used to assess the quality of the raw material before processing. On the other hand, manufacturing process predictors can be changed in the manufacturing process. Improving product yield by 1 % will boost revenue by approximately one hundred thousand dollars per batch.</p>
<p>Load the data in R.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ChemicalManufacturingProcess)</code></pre>
</div>
<div id="impute-missing-values." class="section level3">
<h3><span class="header-section-number">3.2.2</span> Impute missing values.</h3>
<p>A small percentage of cells in the predictor set contain missing values. We are asked to use an imputation function to fill in these missing values.</p>
<p>We find the following NAs in the data.</p>
<ul>
<li>Row 1 - Has 11 variables where this row is the only NA for that variable: manufacturing processes 1,4,5,7,8,12,22,23,24,40,41</li>
<li>Row 23 - Has 1 variable where this row is the only NA for that variable: manufacturing process 14</li>
<li>Rows 172,173,174,175,176 - Have NAs in manufacturing processes 25-31,33-36 (not 32!)</li>
<li><p>Rows 1,2,3,4,5,6,22,23,24 - Have NAs in manufacturing processes 3,10, and 11</p></li>
<li>Manufacturing process 6 - has NA in rows 1 and 90</li>
<li><p>Manufacturing process 2 - has NA in rows 1,134, and 139</p></li>
<li>Manufacturing process 3 - also has NA in rows 15-20</li>
<li><p>Manufacturing process 11 - also has NA in row 98</p></li>
</ul>
<p>We also find a few outliers that I believe would be good to replace with an NA and impute. These are:</p>
<ul>
<li>One row (108) has a 0 for mps 25,26,27,29,30,and 31, while all other observations are significantly larger.</li>
<li>Mps 16, 18, and 20 all have one zero, while remaining values are &gt;4000.</li>
<li>Mps 22, 23, 38, 39, 42, 44 and 45 each have a handful of zeros. In most of these variables, these zeros are unusually small relative to the nonzero values. Even when this is not the case (nonzero values aren’t that large), the zeroes are also recurrent within a few rows in a way that makes them seem suspect.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(var <span class="cf">in</span> <span class="kw">paste0</span>(<span class="st">&quot;ManufacturingProcess&quot;</span>,<span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">18</span>,<span class="dv">20</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">29</span>,<span class="dv">30</span>,<span class="dv">31</span>,<span class="dv">38</span>,<span class="dv">39</span>,<span class="dv">42</span>,<span class="dv">44</span>,<span class="dv">45</span>)))
{
    zero_indices &lt;-<span class="st"> </span><span class="kw">which</span>(ChemicalManufacturingProcess[,var] <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(ChemicalManufacturingProcess[,var]) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)
    ChemicalManufacturingProcess[zero_indices,var] &lt;-<span class="st"> </span><span class="ot">NA</span>
}</code></pre>
<p>Start with impute.knn.</p>
<pre class="sourceCode r"><code class="sourceCode r">ChemicalManufacturingProcess_imputed &lt;-<span class="st"> </span><span class="kw">impute.knn</span>(<span class="kw">as.matrix</span>(ChemicalManufacturingProcess),<span class="dt">k=</span><span class="dv">10</span>,<span class="dt">rng.seed=</span><span class="dv">1392</span>)
ChemicalManufacturingProcess_imputed &lt;-<span class="st"> </span><span class="kw">data.frame</span>(ChemicalManufacturingProcess_imputed<span class="op">$</span>data,<span class="dt">check.names=</span><span class="ot">FALSE</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre>
<p>For manufacturing processes 2 and 28, they are actually bimodal, with a bunch of zeroes then continuous numeric variables that are much larger.</p>
<p>If the imputed value is less than the half the minimum of non-zero values, change to 0.</p>
<p>Also round to match previous level of precision.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(var <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;ManufacturingProcess02&quot;</span>,<span class="st">&quot;ManufacturingProcess28&quot;</span>))
{
    half_min_value &lt;-<span class="st"> </span><span class="kw">min</span>(ChemicalManufacturingProcess[ChemicalManufacturingProcess[,var] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,var],<span class="dt">na.rm=</span><span class="ot">TRUE</span>)<span class="op">/</span><span class="dv">2</span>
    ChemicalManufacturingProcess_imputed[<span class="kw">which</span>(<span class="kw">is.na</span>(ChemicalManufacturingProcess[,var]) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span>ChemicalManufacturingProcess_imputed[,var] <span class="op">&lt;</span><span class="st"> </span>half_min_value),var] &lt;-<span class="st"> </span><span class="dv">0</span>
    ChemicalManufacturingProcess_imputed[,var] &lt;-<span class="st"> </span><span class="kw">round</span>(ChemicalManufacturingProcess_imputed[,var],<span class="dt">digits=</span><span class="dv">1</span>)
}</code></pre>
<p>For remaining variables, imputed values from impute.knn looked good. Just round to the appropriate level of precision within the imputed values.</p>
<pre class="sourceCode r"><code class="sourceCode r">NAs_per_var &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.vector</span>(<span class="kw">apply</span>(ChemicalManufacturingProcess,<span class="dv">2</span>,<span class="cf">function</span>(x)<span class="kw">length</span>(<span class="kw">which</span>(<span class="kw">is.na</span>(x) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)))))
vars_with_NAs &lt;-<span class="st"> </span><span class="kw">colnames</span>(ChemicalManufacturingProcess)[NAs_per_var <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]
vars_with_NAs &lt;-<span class="st"> </span><span class="kw">setdiff</span>(vars_with_NAs,<span class="kw">c</span>(<span class="st">&quot;ManufacturingProcess02&quot;</span>,<span class="st">&quot;ManufacturingProcess28&quot;</span>))
vars_with_NAs &lt;-<span class="st"> </span><span class="kw">setdiff</span>(vars_with_NAs,<span class="kw">paste0</span>(<span class="st">&quot;ManufacturingProcess&quot;</span>,<span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">18</span>,<span class="dv">20</span>,<span class="dv">38</span>,<span class="dv">39</span>,<span class="dv">42</span>,<span class="dv">44</span>,<span class="dv">45</span>))) <span class="co">#Initially did not include these variables when manually calculated appropriate precision. Will round these in a separate loop.</span>
digits_precision &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dt">times=</span><span class="dv">8</span>),<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars_with_NAs))
{
    var =<span class="st"> </span>vars_with_NAs[i]
    digits =<span class="st"> </span>digits_precision[i]
    ChemicalManufacturingProcess_imputed[,var] &lt;-<span class="st"> </span><span class="kw">round</span>(ChemicalManufacturingProcess_imputed[,var],<span class="dt">digits=</span>digits)
}</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">vars_with_NAs &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;ManufacturingProcess&quot;</span>,<span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">18</span>,<span class="dv">20</span>,<span class="dv">38</span>,<span class="dv">39</span>,<span class="dv">42</span>,<span class="dv">44</span>,<span class="dv">45</span>))
digits_precision &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars_with_NAs))
{
    var =<span class="st"> </span>vars_with_NAs[i]
    digits =<span class="st"> </span>digits_precision[i]
    ChemicalManufacturingProcess_imputed[,var] &lt;-<span class="st"> </span><span class="kw">round</span>(ChemicalManufacturingProcess_imputed[,var],<span class="dt">digits=</span>digits)
}</code></pre>
</div>
<div id="data-exploration-and-additional-manual-transformation" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Data exploration and additional manual transformation</h3>
<p>Look at distribution of yield.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(ChemicalManufacturingProcess_imputed<span class="op">$</span>Yield,<span class="dt">labels=</span><span class="ot">TRUE</span>,<span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Observations&quot;</span>,<span class="dt">main=</span><span class="st">&quot;Yield&quot;</span>)</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-31-1.png" width="576" /></p>
<p>And of biological variables.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="dv">13</span>)
{
    <span class="kw">hist</span>(ChemicalManufacturingProcess_imputed[,i],
        <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Observations&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(ChemicalManufacturingProcess_imputed)[i],<span class="dt">labels=</span><span class="ot">TRUE</span>)
}</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-32-1.png" width="960" /></p>
<p>All except 7 look like standard continuous variables, whether normally distributed or skewed.</p>
<p>For BiologicalMaterial07, there are actually 173 observations with 100 and 3 with 100.83, no in between.</p>
<p>Convert to binary where 0 = 100 and 1 = 100.83.</p>
<pre class="sourceCode r"><code class="sourceCode r">ChemicalManufacturingProcess[,<span class="st">&quot;BiologicalMaterial07&quot;</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(ChemicalManufacturingProcess[,<span class="st">&quot;BiologicalMaterial07&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>,<span class="dv">1</span>,<span class="dv">0</span>)</code></pre>
<p>Now, on to manufacturing processes.</p>
<pre class="sourceCode r"><code class="sourceCode r">mps_data &lt;-<span class="st"> </span>ChemicalManufacturingProcess_imputed[,<span class="dv">14</span><span class="op">:</span><span class="kw">ncol</span>(ChemicalManufacturingProcess)]
unique_per_mp &lt;-<span class="st"> </span><span class="kw">apply</span>(mps_data,<span class="dv">2</span>,<span class="cf">function</span>(x)<span class="kw">length</span>(<span class="kw">unique</span>(x)))
mps_data_for_barplots &lt;-<span class="st"> </span>mps_data[,unique_per_mp <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>]
mps_data_for_histograms &lt;-<span class="st"> </span>mps_data[,unique_per_mp <span class="op">&gt;=</span><span class="st"> </span><span class="dv">14</span>]
mps_data_barplot_nonpanel &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.vector</span>(mps_data[,unique_per_mp <span class="op">==</span><span class="st"> </span><span class="dv">12</span>]))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mps_data_for_barplots))
{
    mps_data_for_barplots[,i] &lt;-<span class="st"> </span><span class="kw">factor</span>(mps_data_for_barplots[,i],<span class="dt">levels=</span><span class="kw">unique</span>(mps_data_for_barplots[,i])[<span class="kw">order</span>(<span class="kw">unique</span>(mps_data_for_barplots[,i]))])
    <span class="kw">barplot</span>(<span class="kw">table</span>(mps_data_for_barplots[,i]),<span class="dt">ylab=</span><span class="st">&quot;Observations&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(mps_data_for_barplots)[i])
}</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-35-1.png" width="960" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">table</span>(mps_data_barplot_nonpanel),<span class="dt">ylab=</span><span class="st">&quot;Observations&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(mps_data)[unique_per_mp <span class="op">==</span><span class="st"> </span><span class="dv">12</span>])</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-36-1.png" width="576" /></p>
<p>We find a few variables that should be converted to binary.</p>
<p>We also have a few (e.g. mp 23) that may actually be counts vs. continuous, but we can still treat them the same as we would a numeric variable.</p>
<p>Don’t think we need to worry about special transformation on the ones with more than two unique values.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">4</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mps_data_for_histograms))
{
    <span class="kw">hist</span>(mps_data_for_histograms[,i],
        <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Obs&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(mps_data_for_histograms)[i],<span class="dt">labels=</span><span class="ot">TRUE</span>)
}</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-37-1.png" width="960" /></p>
<p>As mentioned earlier, mps 2 and 28 have a bunch of zeroes, then larger values.</p>
<p>Looks like we probably should have also done the 0 to NA then impute for mp 1 earlier. We should do that now along with converting select variables to binary.</p>
<p>All other variables appear to be standard numeric variables with various degrees of skew.</p>
<pre class="sourceCode r"><code class="sourceCode r">formerly_zero &lt;-<span class="st"> </span><span class="kw">which</span>(ChemicalManufacturingProcess_imputed[,<span class="st">&quot;ManufacturingProcess01&quot;</span>] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)
ChemicalManufacturingProcess_imputed[formerly_zero,<span class="st">&quot;ManufacturingProcess01&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
ChemicalManufacturingProcess_imputed &lt;-<span class="st"> </span><span class="kw">impute.knn</span>(<span class="kw">as.matrix</span>(ChemicalManufacturingProcess_imputed),<span class="dt">k=</span><span class="dv">10</span>,<span class="dt">rng.seed=</span><span class="dv">1392</span>)
ChemicalManufacturingProcess_imputed &lt;-<span class="st"> </span><span class="kw">data.frame</span>(ChemicalManufacturingProcess_imputed<span class="op">$</span>data,<span class="dt">check.names=</span><span class="ot">FALSE</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
ChemicalManufacturingProcess_imputed[,<span class="st">&quot;ManufacturingProcess01&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(ChemicalManufacturingProcess_imputed[,<span class="st">&quot;ManufacturingProcess01&quot;</span>],<span class="dt">digits=</span><span class="dv">1</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">unique_values_per_var &lt;-<span class="st"> </span><span class="kw">apply</span>(ChemicalManufacturingProcess_imputed,<span class="dv">2</span>,<span class="cf">function</span>(x)<span class="kw">length</span>(<span class="kw">unique</span>(x)))
<span class="cf">for</span>(var <span class="cf">in</span> <span class="kw">which</span>(unique_values_per_var <span class="op">==</span><span class="st"> </span><span class="dv">2</span>))
{
    ChemicalManufacturingProcess_imputed[,var] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(ChemicalManufacturingProcess_imputed[,var] <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(ChemicalManufacturingProcess_imputed[,var]),<span class="dv">0</span>,<span class="dv">1</span>)
}</code></pre>
</div>
<div id="automated-data-transformation-and-redo-exploration" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Automated data transformation and redo exploration</h3>
<p>Let’s move on to cleaning up in a more automated way using the preProcess function.</p>
<p>Then, I will show code to explore the now-transformed values. Not running this to avoid this becoming too long, but I checked and transformations looked reasonable.</p>
<pre class="sourceCode r"><code class="sourceCode r">ChemicalManufacturingProcess_predictors_imputed_not_cleaned &lt;-<span class="st"> </span>ChemicalManufacturingProcess_imputed[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(ChemicalManufacturingProcess_imputed)]
preProcess_params &lt;-<span class="st"> </span><span class="kw">preProcess</span>(ChemicalManufacturingProcess_predictors_imputed_not_cleaned,
                                <span class="dt">method=</span><span class="kw">c</span>(<span class="st">&quot;BoxCox&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))
ChemicalManufacturingProcess_predictors_imputed_cleaned &lt;-<span class="st"> </span><span class="kw">predict</span>(preProcess_params,ChemicalManufacturingProcess_predictors_imputed_not_cleaned)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)
{
<span class="kw">hist</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned[,i],        
    <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Observations&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned)[i],<span class="dt">labels=</span><span class="ot">TRUE</span>)
}</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)
{
<span class="kw">plot</span>(ChemicalManufacturingProcess_predictors_imputed_not_cleaned[,i],
    ChemicalManufacturingProcess_predictors_imputed_cleaned[,i],
    <span class="dt">xlab=</span><span class="st">&quot;Before&quot;</span>,
    <span class="dt">ylab=</span><span class="st">&quot;After&quot;</span>,
    <span class="dt">main=</span><span class="kw">colnames</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned)[i])
}</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">5</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">13</span><span class="op">:</span><span class="kw">ncol</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned))
{
<span class="kw">hist</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned[,i],
    <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Obs&quot;</span>,<span class="dt">main=</span><span class="kw">colnames</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned)[i],<span class="dt">labels=</span><span class="ot">TRUE</span>)
}</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">5</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">13</span><span class="op">:</span><span class="kw">ncol</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned))
{
<span class="kw">plot</span>(ChemicalManufacturingProcess_predictors_imputed_not_cleaned[,i],
    ChemicalManufacturingProcess_predictors_imputed_cleaned[,i],
    <span class="dt">xlab=</span><span class="st">&quot;Before&quot;</span>,
    <span class="dt">ylab=</span><span class="st">&quot;After&quot;</span>,
    <span class="dt">main=</span><span class="kw">colnames</span>(ChemicalManufacturingProcess_predictors_imputed_cleaned)[i])
}</code></pre>
</div>
<div id="training-test-split" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Training-test split</h3>
<p>Now we just need to split the data into an 80-20 training-test split.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1392</span>)
trainIndex &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(ChemicalManufacturingProcess<span class="op">$</span>Yield,<span class="dt">p=</span>.<span class="dv">8</span>,<span class="dt">list =</span> <span class="ot">FALSE</span>,<span class="dt">times=</span><span class="dv">1</span>)
ChemicalManufacturingProcess_transformed &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Yield =</span> ChemicalManufacturingProcess<span class="op">$</span>Yield,ChemicalManufacturingProcess_predictors_imputed_cleaned,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
trainingData &lt;-<span class="st"> </span>ChemicalManufacturingProcess_transformed[trainIndex,]
testData &lt;-<span class="st"> </span>ChemicalManufacturingProcess_transformed[<span class="op">-</span>trainIndex,]
trainingData &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> trainingData[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(trainingData)],<span class="dt">y =</span> trainingData<span class="op">$</span>Yield)
testData &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> testData[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(testData)],<span class="dt">y =</span> testData<span class="op">$</span>Yield)</code></pre>
</div>
<div id="building-models" class="section level3">
<h3><span class="header-section-number">3.2.6</span> Building models</h3>
<p>Set seed before we run all these models.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1392</span>)</code></pre>
<div id="linear-model" class="section level4">
<h4><span class="header-section-number">3.2.6.1</span> Linear model</h4>
<pre class="sourceCode r"><code class="sourceCode r">linear_model &lt;-<span class="st"> </span><span class="kw">step</span>(<span class="kw">lm</span>(Yield <span class="op">~</span><span class="st"> </span>.,<span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">Yield =</span> trainingData<span class="op">$</span>y,trainingData<span class="op">$</span>x)),<span class="dt">trace=</span><span class="ot">FALSE</span>)</code></pre>
</div>
<div id="neural-networks-1" class="section level4">
<h4><span class="header-section-number">3.2.6.2</span> Neural networks</h4>
<p>Let’s try the neural networks method with model averaging.</p>
<pre class="sourceCode r"><code class="sourceCode r">nnetGrid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">.decay =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">.1</span>),
                <span class="dt">.size =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),
                <span class="dt">.bag =</span> <span class="ot">FALSE</span>)
averaging_nnet_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                            <span class="dt">method=</span><span class="st">&quot;avNNet&quot;</span>,
                            <span class="dt">tuneGrid =</span> nnetGrid,
                            <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                            <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                            <span class="dt">linout =</span> <span class="ot">TRUE</span>,
                            <span class="dt">trace=</span><span class="ot">FALSE</span>,
                            <span class="dt">maxit =</span> <span class="dv">500</span>)</code></pre>
</div>
<div id="multivariate-adaptive-regression-splines-mars-1" class="section level4">
<h4><span class="header-section-number">3.2.6.3</span> Multivariate Adaptive Regression Splines (MARS)</h4>
<p>Use the earth command from the earth package.</p>
<pre class="sourceCode r"><code class="sourceCode r">MARS_model &lt;-<span class="st"> </span><span class="kw">earth</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y)</code></pre>
</div>
<div id="support-vector-machine-svm-1" class="section level4">
<h4><span class="header-section-number">3.2.6.4</span> Support Vector Machine (SVM)</h4>
<p>I tried running SVM with a polynomial kernel here, but runtime was impractically long.</p>
<p>However, I will try running with both a linear and radial basis function kernel.</p>
<pre class="sourceCode r"><code class="sourceCode r">SVM_linear_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                        <span class="dt">method=</span><span class="st">&quot;svmLinear&quot;</span>,
                        <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                        <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                        <span class="dt">tuneLength =</span> <span class="dv">14</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">SVM_RBF_model &lt;-<span class="st"> </span><span class="kw">train</span>(trainingData<span class="op">$</span>x,trainingData<span class="op">$</span>y,
                    <span class="dt">method=</span><span class="st">&quot;svmRadial&quot;</span>,
                    <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>),
                    <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                    <span class="dt">tuneLength =</span> <span class="dv">14</span>)</code></pre>
</div>
<div id="k-nearest-neighbors-knn-1" class="section level4">
<h4><span class="header-section-number">3.2.6.5</span> K-Nearest Neighbors (KNN)</h4>
<p>Let’s run KNN just as it was run in the question example for 7.2.</p>
<pre class="sourceCode r"><code class="sourceCode r">knn_model &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="dt">x =</span> trainingData<span class="op">$</span>x,
                <span class="dt">y =</span> trainingData<span class="op">$</span>y,
                <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,
                <span class="dt">preProc =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),
                <span class="dt">tuneLength =</span> <span class="dv">10</span>)</code></pre>
</div>
</div>
<div id="a-1" class="section level3">
<h3><span class="header-section-number">3.2.7</span> a</h3>
<p><img src="kj7/7.5a.png" /></p>
<div id="comparing-nonlinear-models" class="section level4">
<h4><span class="header-section-number">3.2.7.1</span> Comparing nonlinear models</h4>
<p>Use the function to look at error and R-squared of a given model applied to the test data.</p>
<pre class="sourceCode r"><code class="sourceCode r">error_and_Rsquared &lt;-<span class="st"> </span><span class="cf">function</span>(model){
    predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model,<span class="dt">newdata =</span> testData<span class="op">$</span>x)
    <span class="kw">return</span>(<span class="kw">postResample</span>(<span class="dt">pred =</span> predictions, <span class="dt">obs =</span> testData<span class="op">$</span>y))
}</code></pre>
<p>Also add a function to get error and Rsquared running model on training data.</p>
<pre class="sourceCode r"><code class="sourceCode r">error_and_Rsquared_train &lt;-<span class="st"> </span><span class="cf">function</span>(model){
    predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model,<span class="dt">newdata =</span> trainingData<span class="op">$</span>x)
    <span class="kw">return</span>(<span class="kw">postResample</span>(<span class="dt">pred =</span> predictions, <span class="dt">obs =</span> trainingData<span class="op">$</span>y))
}</code></pre>
<p>Run function to get error and R-squared for each model on test data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(model <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;averaging_nnet_model&quot;</span>,<span class="st">&quot;MARS_model&quot;</span>,<span class="st">&quot;SVM_linear_model&quot;</span>,<span class="st">&quot;SVM_RBF_model&quot;</span>,<span class="st">&quot;knn_model&quot;</span>))
{
    <span class="kw">print</span>(model)
    <span class="kw">print</span>(<span class="kw">error_and_Rsquared</span>(<span class="kw">get</span>(model)))
}</code></pre>
<pre><code>## [1] &quot;averaging_nnet_model&quot;
##      RMSE  Rsquared       MAE 
## 1.6406437 0.4081811 1.3439833 
## [1] &quot;MARS_model&quot;
##      RMSE  Rsquared       MAE 
## 1.1460383 0.5890902 0.8894378 
## [1] &quot;SVM_linear_model&quot;
##      RMSE  Rsquared       MAE 
## 1.4887626 0.4111474 1.0380389 
## [1] &quot;SVM_RBF_model&quot;
##      RMSE  Rsquared       MAE 
## 0.9674454 0.7110587 0.7355990 
## [1] &quot;knn_model&quot;
##     RMSE Rsquared      MAE 
## 1.346539 0.437884 1.046375</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(model <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;averaging_nnet_model&quot;</span>,<span class="st">&quot;MARS_model&quot;</span>,<span class="st">&quot;SVM_linear_model&quot;</span>,<span class="st">&quot;SVM_RBF_model&quot;</span>,<span class="st">&quot;knn_model&quot;</span>))
{
    <span class="kw">print</span>(model)
    <span class="kw">print</span>(<span class="kw">error_and_Rsquared_train</span>(<span class="kw">get</span>(model)))
}</code></pre>
<pre><code>## [1] &quot;averaging_nnet_model&quot;
##      RMSE  Rsquared       MAE 
## 0.2334388 0.9857997 0.1677897 
## [1] &quot;MARS_model&quot;
##      RMSE  Rsquared       MAE 
## 0.9172357 0.7551188 0.7375057 
## [1] &quot;SVM_linear_model&quot;
##      RMSE  Rsquared       MAE 
## 0.9060775 0.7621834 0.6234245 
## [1] &quot;SVM_RBF_model&quot;
##      RMSE  Rsquared       MAE 
## 0.1788744 0.9927243 0.1752104 
## [1] &quot;knn_model&quot;
##      RMSE  Rsquared       MAE 
## 1.2081737 0.6430018 0.9896870</code></pre>
<p>Looks like SVM with radial basis function kernel performs the best on both training and test data.</p>
</div>
</div>
<div id="b-1" class="section level3">
<h3><span class="header-section-number">3.2.8</span> b</h3>
<p><img src="kj7/7.5b.png" /></p>
<div id="comparing-nonlinear-vs.-linear-model" class="section level4">
<h4><span class="header-section-number">3.2.8.1</span> Comparing nonlinear vs. linear model</h4>
<p>Let’s look in more detail at the optimal nonlinear model.</p>
<pre class="sourceCode r"><code class="sourceCode r">varImp_nonlinear &lt;-<span class="st"> </span><span class="kw">varImp</span>(SVM_RBF_model,<span class="dt">scale=</span><span class="ot">TRUE</span>)
top10 &lt;-<span class="st"> </span><span class="kw">rownames</span>(varImp_nonlinear<span class="op">$</span>importance)[<span class="kw">order</span>(varImp_nonlinear<span class="op">$</span>importance<span class="op">$</span>Overall,<span class="dt">decreasing=</span><span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]]
top10[<span class="kw">order</span>(top10)]</code></pre>
<pre><code>##  [1] &quot;BiologicalMaterial02&quot;   &quot;BiologicalMaterial03&quot;  
##  [3] &quot;BiologicalMaterial06&quot;   &quot;BiologicalMaterial12&quot;  
##  [5] &quot;ManufacturingProcess09&quot; &quot;ManufacturingProcess13&quot;
##  [7] &quot;ManufacturingProcess17&quot; &quot;ManufacturingProcess31&quot;
##  [9] &quot;ManufacturingProcess32&quot; &quot;ManufacturingProcess36&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">top10_nonlinear &lt;-<span class="st"> </span>top10</code></pre>
<p>And the linear model.</p>
<pre class="sourceCode r"><code class="sourceCode r">varImp_linear &lt;-<span class="st"> </span><span class="kw">varImp</span>(linear_model,<span class="dt">scale=</span><span class="ot">TRUE</span>)
top10 &lt;-<span class="st"> </span><span class="kw">rownames</span>(varImp_linear)[<span class="kw">order</span>(varImp_linear<span class="op">$</span>Overall,<span class="dt">decreasing=</span><span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]]
top10[<span class="kw">order</span>(top10)]</code></pre>
<pre><code>##  [1] &quot;ManufacturingProcess04&quot; &quot;ManufacturingProcess13&quot;
##  [3] &quot;ManufacturingProcess17&quot; &quot;ManufacturingProcess21&quot;
##  [5] &quot;ManufacturingProcess27&quot; &quot;ManufacturingProcess32&quot;
##  [7] &quot;ManufacturingProcess33&quot; &quot;ManufacturingProcess37&quot;
##  [9] &quot;ManufacturingProcess39&quot; &quot;ManufacturingProcess44&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">top10_linear &lt;-<span class="st"> </span>top10</code></pre>
<p>The optimal nonlinear model includes 4 biological variables in the top 10 most important (2,3,6,and 12).</p>
<p>Manufacturing process variables in the top 10 in nonlinear are 9,13,17,31,32, and 36.</p>
<p>The linear model top predictors are all manufacturing processes, no biological materials!</p>
<p>Manufacturing process variables 9, 31, and 36 are also unique as top variables in the nonlinear model.</p>
</div>
</div>
<div id="c-1" class="section level3">
<h3><span class="header-section-number">3.2.9</span> c</h3>
<p><img src="kj7/7.5c.png" /></p>
<p>Let’s check out why this might be.</p>
<pre class="sourceCode r"><code class="sourceCode r">unique_to_nonlinear &lt;-<span class="st"> </span><span class="kw">setdiff</span>(top10_nonlinear,top10_linear)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))
<span class="cf">for</span>(var <span class="cf">in</span> unique_to_nonlinear)
{
    <span class="kw">plot</span>(trainingData<span class="op">$</span>x[,var],trainingData<span class="op">$</span>y,
        <span class="dt">xlab=</span><span class="st">&quot;Variable&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Yield&quot;</span>,<span class="dt">main=</span>var)
}</code></pre>
<p><img src="HW2_files/figure-html/unnamed-chunk-54-1.png" width="960" /></p>
<p>At least some of these look like they might be correlated to yield better by a curve vs. a straight line. So it makes sense that they weren’t important to (or maybe even selected at all for) by the linear model.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="kj6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="kj8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-KJ7.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["HW2.pdf", "HW2.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
